.option norvc

// helper for GP initialization, see below
.section .sdata
sdataSection:
.text
textSection:

////////////////////////////////////////////////////////////////////////////////////////////////////
// entry points
////////////////////////////////////////////////////////////////////////////////////////////////////

entryPoint:
    j start
    j hang

////////////////////////////////////////////////////////////////////////////////////////////////////
// startup
////////////////////////////////////////////////////////////////////////////////////////////////////

start:

    .option push
    .option norelax
    la gp, __global_pointer$
    .option pop

    // test code
    li s0, 0x03000000
mainLoop:

    // blue
    li s1, 1
    sw s1, 0(s0)
    li a0, 500
    call delay

    // black
    li s1, 0
    sw s1, 0(s0)
    li a0, 500
    call delay

    // purple
    li s1, 5
    sw s1, 0(s0)
    li a0, 500
    call delay

    // black
    li s1, 0
    sw s1, 0(s0)
    li a0, 500
    call delay

    j mainLoop


////////////////////////////////////////////////////////////////////////////////////////////////////
// delay
////////////////////////////////////////////////////////////////////////////////////////////////////

delay:
    beq a0, x0, return
    addi t0, x0, 1000
innerLoop:
    addi x0, x0, 0 // NOP = 4 cycles
    addi x0, x0, 0 // 8 cycles
    addi x0, x0, 0 // 12
    addi x0, x0, 0 // 16
    addi x0, x0, 0 // 20
    addi x0, x0, 0 // 24
    addi x0, x0, 0 // 28
    addi t0, t0, -1 // 44
    bne t0, x0, innerLoop // 48 cycles ~~ 1 Âµs
    addi a0, a0, -1
    j delay

return:
    ret

////////////////////////////////////////////////////////////////////////////////////////////////////
// hang
////////////////////////////////////////////////////////////////////////////////////////////////////

hang:
    j hang
